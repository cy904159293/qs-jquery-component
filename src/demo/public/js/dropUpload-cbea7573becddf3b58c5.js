webpackJsonp([3],{"+R6n":function(t,e,i){"use strict";var n=s(i("0iPh")),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i("6QEj")),a=i("BzRZ");i("qShT");var o=s(i("E1Zh"));function s(t){return t&&t.__esModule?t:{default:t}}(new function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.init=function(){},this._bindEvent=function(){e.outer.on("click",function(){})},this._init=function(){e.uploadImg=new o.default({outer:(0,n.default)("#test1"),url:"uploadFile",maxImgs:3}),r.initCode(e.outer),r.createDetailTable({outer:e.outer,propsList:a.propsList,apiList:a.apiList}),e._bindEvent()},this.outer=(0,n.default)("#dropUploadPageOuter"),this._init()}).init()},"0iPh":function(t,e){t.exports=window.jQuery},BzRZ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.propsList=[{param:"outer",description:"外部容器，一个长度的jqueryDom",type:"jQueryObject",default:""},{param:"maxImgs",description:"最大图片数",type:"number",default:"3"},{param:"imgs",description:"已经有的图片，图片地址的数组",type:"Array",default:"[]"},{param:"url",description:"图片上传的url地址",type:"String",default:""}],e.apiList=[{funcName:"setImgs",description:"设置已有图片",params:"imgs: Array"},{funcName:"getImgs",description:"获取已经上传的图片列表",params:""}]},E1Zh:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(i("0iPh"));i("Swsl");o(i("5SDb"));var r=o(i("w4T/")),a=o(i("pT4b"));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){var t=this;this.setImgs=function(e){t.imgs=e,t._renderImgs()},this.getImgs=function(){return t.imgs},this._bindEvent=function(){var e=t;t.outer.on("click",".add-new-img-btn-c",function(){(0,n.default)(this).next().trigger("click")}).on("change",'input[type="file"]',function(){e._uploadImg(this.files[0],e.imgs.length),e._resetFile()}).on("click",".fa-search-plus",function(){var t=(0,n.default)(this).parents(".drag-upload-img-item-c").data("index");e.imgViewer.show(e.imgs,t)}).on("click",".fa-trash-o",function(){var t=(0,n.default)(this).parents(".drag-upload-img-item-c");e.imgs.splice(t.data("index"),1),t.remove(),e.imgs.length<e.maxImgs&&e.outer.find(".add-new-img-btn-c").show()})},this._uploadImg=function(e,i){var n=window.URL.createObjectURL(e);t._renderNewImgs(n),t.dealImage(n,{quality:.7,width:1920},function(n){var a=new FormData;a.append("file",t.convertBase64UrlToBlob(n),e.name),setTimeout(function(){var e,n,o;(0,r.default)({url:t.url,fd:a,onprogress:(e=t.outer.find(".drag-upload-img-item-c").eq(i).find(".drag-upload-progress"),n=e.find(".drag-upload-progress-bar"),o=e.find(".drag-upload-progress-text"),function(t){var i=Math.round(t.loaded/t.total*100);n.width(i+"%"),o.text(i+"%"),i>=100&&setTimeout(function(){e.remove()},100)}),success:function(e){e.success&&(t.imgs[i]=e.data)}})},100)})},this._renderHtml=function(){t.outer.html('<div class="drag-upload-outer"></div>'),t._renderImgs()},this._renderImgs=function(){t.outer.html([].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(t.imgs.map(function(e,i){return t._renderImg(e,i)})),[t._renderAddBtn()]).join(""))},this._renderAddBtn=function(){return'<div class="add-new-img-btn-c" style="display: '+(t.maxImgs>t.imgs.length?"inline-block":"none")+'">+</div><input type="file" style="display: none" />'},this._resetFile=function(){t.outer.find(".add-new-img-btn-c").next().remove().end().after('<input type="file" style="display: none" />')},this._renderImg=function(t,e,i){return'<div class="drag-upload-img-item-c'+(i?" drag-upload-img-in":"")+'" data-index="'+e+'"><img src="'+t+'" />\n<div class="drag-upload-tool-c"><i class="fa fa-search-plus" title="查看大图"></i><i class="fa fa-trash-o" title="移除图片"></i></div>\n'+(i?'<div class="drag-upload-progress"><div class="drag-upload-progress-bar" style="width: 0"></div><div class="drag-upload-progress-text">0%</div></div>':"")+"\n</div>"},this._renderNewImgs=function(e){t.imgs.push(e),t.imgs.length===t.maxImgs&&t.outer.find(".add-new-img-btn-c").hide(),t.outer.find(".add-new-img-btn-c").before(t._renderImg(e,t.imgs.length-1,!0)),setTimeout(function(){t.outer.find(".drag-upload-img-in").removeClass("drag-upload-img-in")},0)},this.dealImage=function(t,e,i){var n=new Image;n.src=t,n.onload=function(){var t=this.width,n=this.height,r=t/n;e.width=e.width>t?t:e.width,t=e.width||t,n=e.height||t/r;var a=.7,o=document.createElement("canvas"),s=o.getContext("2d"),u=document.createAttribute("width");u.nodeValue=t;var d=document.createAttribute("height");d.nodeValue=n,o.setAttributeNode(u),o.setAttributeNode(d),s.drawImage(this,0,0,t,n),e.quality&&e.quality<=1&&e.quality>0&&(a=e.quality);var l=o.toDataURL("image/jpeg",a);o=null,i(l)}},this.convertBase64UrlToBlob=function(t){for(var e=window.atob(t.split(",")[1]),i=new ArrayBuffer(e.length),n=new Uint8Array(i),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new Blob([i],{type:"image/png"})},this._init=function(){t.imgViewer=new a.default,t._renderHtml(),t._bindEvent()}};e.default=function t(e){var i=e.outer,r=e.maxImgs,a=void 0===r?3:r,o=e.imgs,u=void 0===o?[]:o,d=e.url,l=void 0===d?"buildingContract/uploadFile":d;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s.call(this),!(i instanceof n.default)||i instanceof n.default&&1!==i.length)throw new Error("Table param outer must be one length jqueryDom");this.imgs=u,this.maxImgs=a,this.outer=i,this.url=l,this._init()}},Swsl:function(t,e){},qShT:function(t,e){},"w4T/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i("THgg"),a=(n=r)&&n.__esModule?n:{default:n};var o=function(t){return function(){var e=$.ajaxSettings.xhr();return"function"!=typeof t?e:(t&&e.upload&&e.upload.addEventListener("progress",t,!1),e)}};e.default=function(t){var e=t.fd,i=t.url,n=t.success,r=t.error,s=void 0===r?function(){}:r,u=t.always,d=void 0===u?function(){}:u,l=t.onprogress;if(!i)throw new Error("uploadFile param url is must");if(!e)throw new Error("uploadFile param fd is must");return"function"!=typeof s&&(s=function(){}),"function"!=typeof n&&(n=function(){}),"function"!=typeof d&&(d=function(){}),(0,a.default)({url:i,type:"POST",headers:{Accept:"application/json;charset=UTF-8"},data:e,cache:!1,contentType:!1,processData:!1,xhr:o(l),success:n,error:s}).always(function(){d()})}}},["+R6n"]);